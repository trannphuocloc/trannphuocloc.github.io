---
title: "Exploring Sales data with RFM Analysis"
excerpt: "Using the RFM (Recency, Frequency, Monetary) Analysis technique to segment customers <br/><img src='/images/RFMsample.png'>"
collection: portfolio
author_profile: false
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Nhúng thư viện Prism.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.min.css">
    <style>
        pre {
		        display: inline-block;
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            overflow-x: auto;
        }
    </style>
  <title>Scrollable Code Block</title>
  <style>
      /* CSS để tạo nút cuộn cho block code */
      .scrollable-code {
          width: 760px; /* Chiều rộng của block code */
          height: 200px; /* Chiều cao của block code */
          overflow-x: auto; /* Tạo ra thanh cuộn ngang khi cần thiết */
          white-space: nowrap; /* Đảm bảo các dòng code không bị wrap */
      }
      .scroll-button {
            margin-top: 2px; /* Khoảng cách từ nút cuộn đến văn bản trên */
             /* Điều chỉnh độ lớn của nút cuộn */
        }
  </style>
</head>

<body>
  <style>
    table {
      width: 760px;
    }

    table thead th{
        text-align: left;
    }

    .table.table-hover tr:hover{
      background: #d4d2d2 ;
    }
      </style>
</body>


<body>
<h2>RFM Summary</h2>
<body>
    <p>RFM Analysis is a measurement technique that uses existing customer behavior data, based on Recency, Frequency and Monetary value of purchases, to predict how customers will act in the future as well as to group them into behavioral segments.</p>
    <p>RFM can help you answer these questions and more:</p>
    <ul>
        <li>Who can you upsell higher-value products to?</li>
        <li>Who can you send personalized messages to keep them from churning?</li>
        <li>Who is most likely to engage with your brand?</li>
        <li>Who can you offer limited-time offers to and try to reactivate?</li>
	      <li>...</li>
    </ul>
<p>For our visualization, three dimensions of Recency, Frequency, and Monetary coincide with 3D graphics. However, it doesn't work effectively and difficult to understand the result. By combining Frequency and Monetary and turning it to 2D, it is much easier to understand because when a customer subscribes to a month for 100 dollar 12 times in 12 months, it is equivalent to when customers subscribe for $1200 per year all at once. At that time, Recency represented the customer's engagement with our brand.</p>

<p>Having 11 customer segments have the same behavior as the table that we will group them into:</p>



<table border="1">
<thead>
    <tr>
        <th style="width: fit-content;">Customer segment</th>
        <th style="width: fit-content;">RFM scores</th>
        <th style="width: fit-content;">Activity</th>
		    <th style="width: fit-content;">Action Recommend</th>
    </tr>
</thead>
    <tr>
        <td>Champions</td>
        <td>555, 554, 544, 545, 454, 455, 445</td>
        <td>Bought recently, buy often and spend the most!</td>
		    <td>Reward them. Can be early adopters for new products. Will promote your brand.</td>
    </tr>
    <tr>
        <td>Loyal customers</td>
        <td>543, 444, 435, 355, 354, 345, 344, 335</td>
        <td>Spend good money with us often. Responsive to promotions. </td>
		    <td>Upsell higher value products. Ask for reviews. Engage them.</td>
    </tr>
    <tr>
        <td>Potential loyalist</td>
        <td>553, 551, 552, 541, 542, 533, 532, 531, 452, 451, 442, 441, 431, 453, 433, 432, 423, 353, 352, 351, 342, 341, 333, 323</td>
        <td>Recent customers, but spent a good amount and bought more than once.</td>
        <td>Offer membership / loyalty program, recommend other products.</td>
    </tr>
    <tr>
        <td>Recent customers</td>
        <td>512, 511, 422, 421, 412, 411, 311</td>
        <td>Bought most recently, but not often.</td>
        <td>Provide on-boarding support, give them early success, start building relationship.</td>
    </tr>
    <tr>
        <td>Promising</td>
        <td>525, 524, 523, 522, 521, 515, 514, 513, 425, 424, 413, 414, 415, 315, 314, 313</td>
        <td>Recent shoppers, but haven’t spent much.</td>
        <td>Create brand awareness, offer free trials</td>
    </tr>
    <tr>
        <td>Customers Needing Attention</td>
        <td>535, 534, 443, 434, 343, 334, 325, 324</td>
        <td>Above average recency, frequency and monetary values. May not have bought very recently though.</td>
        <td>Make limited time offers, Recommend based on past purchases. Reactivate them.</td>
    </tr>
    <tr>
        <td>About to sleep</td>
        <td>331, 321, 312, 221, 213</td>
        <td>Below average recency, frequency and monetary values. Will lose them if not reactivated.</td>
        <td>Share valuable resources, recommend popular products / renewals at discount, reconnect with them</td>
    </tr>
    <tr>
        <td>At risk</td>
        <td>255, 254, 245, 244, 253, 252, 243, 242, 235, 234, 225, 224, 153, 152, 145, 143, 142, 135, 134, 133, 125, 124</td>
        <td>Spent big money and purchased often. But long time ago. Need to bring them back!</td>
        <td>Send personalized emails to reconnect, offer renewals, provide helpful resources.</td>
    </tr>
    <tr>
        <td>Can’t lose them</td>
        <td>155, 154, 144, 214, 215, 115, 114, 113</td>
        <td>Made biggest purchases, and often. But haven’t returned for a long time.</td>
        <td>Win them back via renewals or newer products, don’t lose them to competition, talk to them.</td>
    </tr>
    <tr>
        <td>Hibernating</td>
        <td>332, 322, 231, 241, 251, 233, 232, 223, 222, 132, 123, 122, 212, 211</td>
        <td>Last purchase was long back, low spenders and low number of orders.</td>
        <td>Offer other relevant products and special discounts. Recreate brand value.</td>
    </tr>
    <tr>
        <td>Lost</td>
        <td>111, 112, 121, 131, 141, 151</td>
        <td>Lowest recency, frequency and monetary scores.</td>
        <td>Revive interest with reach out campaign, ignore otherwise.</td>
    </tr>
</table>


<h2>Details</h2>	
Here <a href="https://github.com/trannphuocloc/sales-data">our data set</a> for the project.
And let's jump right in by checking the data 

<h4>Input [1]:</h4>
<pre><code class="language-sql">
SELECT * FROM sales;
</code></pre>

<h4>Output [1]:</h4>
<div style="overflow-x: auto;">
  <table class="table table-hover" border="1" style="width: 2000px;">
  <thead>
    <tr>
      <th>Row_ID</th>
      <th>Order_ID</th>
      <th>Order_Date</th>
      <th>Ship_Date</th>
      <th>Ship_Mode</th>
      <th>Customer_ID</th>
      <th>Customer_Name</th>
      <th>Segment</th>
      <th>Country</th>
      <th >City</th>
      <th >State</th>
      <th >Postal_Code</th>
      <th >Region</th>
      <th >Product_ID</th>
      <th >Category</th>
      <th >Sub_Category</th>
      <th>Product_Name</th>
      <th >Sales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>CA-2017-152156</td>
      <td>08-11-17</td>
      <td>11-11-17</td>
      <td>Second Class</td>
      <td>CG-12520</td>
      <td>Claire Gute</td>
      <td>Consumer</td>
      <td>United States</td>
      <td>Henderson</td>
      <td>Kentucky</td>
      <td>42420</td>
      <td>South</td>
      <td>FUR-BO-10001798</td>
      <td>Furniture</td>
      <td>Bookcases</td>
      <td>Bush Somerset Collection Bookcase</td>
      <td>261.9599915</td>
    </tr>
    <tr>
      <td>2</td>
      <td>CA-2017-152156</td>
      <td>08-11-17</td>
      <td>11-11-17</td>
      <td>Second Class</td>
      <td>CG-12520</td>
      <td>Claire Gute</td>
      <td>Consumer</td>
      <td>United States</td>
      <td>Henderson</td>
      <td>Kentucky</td>
      <td>42420</td>
      <td>South</td>
      <td>FUR-CH-10000454</td>
      <td>Furniture</td>
      <td>Chairs</td>
      <td style="width: max-content;">Hon Deluxe Fabric Upholstered Stacking Chairs, Rounded Back</td>
      <td>731.9400024</td>
    </tr>
    <tr>
      <td>3</td>
      <td>CA-2017-138688</td>
      <td>12-06-17</td>
      <td>16-06-17</td>
      <td>Second Class</td>
      <td>DV-13045</td>
      <td>Darrin Van Huff</td>
      <td>Corporate</td>
      <td>United States</td>
      <td>Los Angeles</td>
      <td>California</td>
      <td>90036</td>
      <td>West</td>
      <td>OFF-LA-10000240</td>
      <td>Office Supplies</td>
      <td>Labels</td>
      <td>Self-Adhesive Address Labels for Typewriters by Universal</td>
      <td>14.61999989</td>
    </tr>
    <tr>
      <td>4</td>
      <td style="width: 5%;">US-2016-108966</td>
      <td>11-10-16</td>
      <td>18-10-16</td>
      <td>Standard Class</td>
      <td>SO-20335</td>
      <td>Sean O'Donnell</td>
      <td>Consumer</td>
      <td>United States</td>
      <td>Fort Lauderdale</td>
      <td>Florida</td>
      <td>33311</td>
      <td>South</td>
      <td>FUR-TA-10000577</td>
      <td>Furniture</td>
      <td>Tables</td>
      <td>Bretford CR4500 Series Slim Rectangular Table</td>
      <td>957.5775146</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
	<tr>
	<td>9797</td>
      <td>CA-2016-128608</td>
      <td>12-01-16</td>
      <td>17-01-16</td>
      <td>Standard Class</td>
      <td>CS-12490</td>
      <td>Cindy Schnelling</td>
      <td>Corporate</td>
      <td>United States</td>
      <td>Toledo</td>
      <td>Ohio</td>
      <td>43615</td>
      <td>East</td>
      <td>OFF-AR-10001374</td>
      <td>Office Supplies</td>
      <td>Art</td>
      <td>BIC Brite Liner Highlighters, Chisel Tip</td>
      <td>10.36800003</td>
    </tr>
    <tr>
      <td>9798</td>
      <td>CA-2016-128608</td>
      <td>12-01-16</td>
      <td>17-01-16</td>
      <td>Standard Class</td>
      <td>CS-12490</td>
      <td>Cindy Schnelling</td>
      <td>Corporate</td>
      <td>United States</td>
      <td>Toledo</td>
      <td>Ohio</td>
      <td>43615</td>
      <td>East</td>
      <td>TEC-PH-10004977</td>
      <td>Technology</td>
      <td>Phones</td>
      <td>GE 30524EE4</td>
      <td>235.1880035</td>
    </tr>
    <tr>
      <td>9799</td>
      <td>CA-2016-128608</td>
      <td>12-01-16</td>
      <td>17-01-16</td>
      <td>Standard Class</td>
      <td>CS-12490</td>
      <td>Cindy Schnelling</td>
      <td>Corporate</td>
      <td>United States</td>
      <td>Toledo</td>
      <td>Ohio</td>
      <td>43615</td>
      <td>East</td>
      <td>TEC-PH-10000912</td>
      <td>Technology</td>
      <td>Phones</td>
      <td>Anker 24W Portable Micro USB Car Charger</td>
      <td>26.37599945</td>
    </tr>
    <tr>
      <td>9800</td>
      <td>CA-2016-128608</td>
      <td>12-01-16</td>
      <td>17-01-16</td>
      <td>Standard Class</td>
      <td>CS-12490</td>
      <td>Cindy Schnelling</td>
      <td>Corporate</td>
      <td>United States</td>
      <td>Toledo</td>
      <td>Ohio</td>
      <td>43615</td>
      <td>East</td>
      <td>TEC-AC-10000487</td>
      <td>Technology</td>
      <td>Accessories</td>
      <td>SanDisk Cruzer 4 GB USB Flash Drive</td>
      <td>10.38399982</td>
	
</tbody>
</table>
</div>
9800 rows x 18 columns


<p></p>	
<p>Our Kaggle dataset is relatively clean, with no null values in any of the fields. Before we take further steps, let's double-check our data using the COUNT function to ensure that it is completely accurate.</p>
<h4>Input [2]:</h4>
<div class="scrollable-code" class="scroll-button">
<pre><code class="language-sql">
  SELECT SUM(
    CASE WHEN CONCAT_WS('', Row_ID, Order_ID, Order_Date, Ship_Date, Ship_Mode, Customer_ID, Customer_Name, Segment, Country, City, State, Postal_Code, Region, Product_ID, Category, Sub_Category, Product_Name, Sales) IS NULL THEN 1 ELSE 0 END 
) AS count_null
FROM sales;
</code></pre>
</div>

<h4>Output [2]</h4>
<table class="table table-hover" border="1" >
  <thead>
    <tr>
      <th style="width: min-content;">count_null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="width: min-content;">0</td>
    </tr>
  </tbody>
</table>

<p>After reviewing the data, we may realize some crucial attributes in the table for analyzing and comparing each type with each other, such as:</p>
<ul>
  <li><strong>Ship mode</strong> includes <strong> Standard Class, Second Class, First Class, and Same Day,</strong> representing the delivery methods that we have served.</li>
  <li><strong>Segment</strong> includes <strong>Consumer, Corporate, and Home Office,</strong> which represent our customer segments.</li>
  <li><strong>Category</strong> includes <strong>Furniture, Office Supplies, and Technology.</strong></li>
  <li>Each <strong>Sub-category</strong> includes <strong>Chairs, Bookcases, Tables, Art, Paper, Copiers, Accessories, and Phones,...</strong> every single sub-category has numerous items from different brands.</li>
  <li><strong>State</strong> represents 49 states in the US excluding Hawaii, which our store isn't located.</li>
</ul>



<p>Let's calculate crucial metrics for sales data based on its characteristics.</p>

<title>Code and Table Layout</title>
<style>
    .container {
        display: flex;
        
    }
    .code {
        width: 72%; /* Đặt chiều rộng của phần mã */
        padding: 5px;
        overflow-x: hidden;
        white-space: nowrap;
        align-items: center;
        display: inline-block;
    }
    .output {
        width: 20%; /* Đặt chiều rộng của phần output */
        align-items: center;
    }
</style>
</head>


<h4>Input [3]:</h4> 
<div class="container">
  <div class="code">
        <!-- Đoạn mã của bạn -->
    <pre><code class="language-sql">
SELECT Ship_Mode, 
      ROUND(SUM(sales),2) AS shipmode_sales 
FROM sales 
GROUP BY Ship_Mode
ORDER BY 2 DESC;
        </code></pre></div>
  <div class="output">
        <!-- Bảng hoặc nội dung đầu ra của bạn -->
    <table class="table table-hover" border="1" style="width: 150px;" >
      <tr>
        <th>Ship_Mode</th>
        <th>shipmode_sales</th>
    </tr>
    <tr>
        <td>Standard Class</td>
        <td>1340831.31</td>
    </tr>
    <tr>
        <td>Second Class</td>
        <td>449914.18</td>
    </tr>
    <tr>
        <td>First Class</td>
        <td>345572.26</td>
    </tr>
    <tr>
        <td>Same Day</td>
        <td>125219.04</td>
    </tr>
    </table>
    </div>
</div>


<h4>Input [4]:</h4> 
<div class="container">
  <div class="code">
        <!-- Đoạn mã của bạn -->
    <pre><code class="language-sql">
SELECT Segment, 
      ROUND(SUM(sales),2) AS segment_sales
FROM sales 
GROUP BY Segment
ORDER BY 2 DESC;
        </code></pre></div>
  <div class="output">
        <!-- Bảng hoặc nội dung đầu ra của bạn -->
    <table class="table table-hover" border="1" style="width: 150px;" >
      <tr>
        <th>Segment</th>
        <th>segment_sales</th>
    </tr>
    <tr>
        <td>Consumer</td>
        <td>1148060.53</td>
    </tr>
    <tr>
        <td>Corporate</td>
        <td>688494.07</td>
    </tr>
    <tr>
        <td>Home Office</td>
        <td>424982.18</td>
    </tr>
    </table>
    </div>
</div>

<h4>Input [5]:</h4> 
<div class="container">
  <div class="code" >
        <!-- Đoạn mã của bạn -->
    <pre><code class="language-sql">
SELECT Category, 
      ROUND(SUM(sales),2) AS category_sales 
FROM sales
GROUP BY Category
ORDER BY 2 DESC
        </code></pre></div>
  <div class="output" >
        <!-- Bảng hoặc nội dung đầu ra của bạn -->
    <table class="table table-hover" border="1" style="width: 150px;" >
      <tr>
        <th>Category</th>
        <th>category_sales</th>
    </tr>
    <tr>
        <td>Technology</td>
        <td>827455.87</td>
    </tr>
    <tr>
        <td>Furniture</td>
        <td>728658.57</td>
    </tr>
    <tr>
        <td>Office Supplies</td>
        <td>705422.33</td>
    </tr>
    </table>
    </div>
</div>

<h4>Input [6]:</h4> 
<div class="container">
  <div class="code">
        <!-- Đoạn mã của bạn -->
    <pre><code class="language-sql">
SELECT Sub_Category, 
      ROUND(SUM(sales),2) AS sub_category_sales 
FROM sales
GROUP BY Sub_Category
ORDER BY 2 DESC
        </code></pre></div>
  <div class="output">
        <!-- Bảng hoặc nội dung đầu ra của bạn -->
    <table class="table table-hover" border="1" style="width: 150px;" >
      <tr>
        <th>Sub_Category</th>
        <th>sub_category_sales</th>
      </tr>
      <tr>
        <td>Phones</td>
        <td>327782.45</td>
      </tr>
      <tr>
        <td>Chairs</td>
        <td>322822.73</td>
      </tr>
      <tr>
        <td>Storage</td>
        <td>219343.39</td>
      </tr>
      <tr>
        <td>Tables</td>
        <td>202810.63</td>
      </tr>
      <tr>
        <td>Binders</td>
        <td>200028.78</td>
      </tr>
      <tr>
        <td>Machines</td>
        <td>189238.63</td>
      </tr>
      <tr>
        <td>Accessories</td>
        <td>164186.7</td>
      </tr>
      <tr>
        <td>Copiers</td>
        <td>146248.09</td>
      </tr>
      <tr>
        <td>Bookcases</td>
        <td>113813.2</td>
      </tr>
      <tr>
        <td>Appliances</td>
        <td>104618.4</td>
      </tr>
      <tr>
        <td>Furnishings</td>
        <td>89212.02</td>
      </tr>
      <tr>
        <td>Paper</td>
        <td>76828.3</td>
      </tr>
      <tr>
        <td>Supplies</td>
        <td>46420.31</td>
      </tr>
      <tr>
        <td>Art</td>
        <td>26705.41</td>
      </tr>
      <tr>
        <td>Envelopes</td>
        <td>16128.05</td>
      </tr>
      <tr>
        <td>Labels</td>
        <td>12347.73</td>
      </tr>
      <tr>
        <td>Fasteners</td>
        <td>3001.96</td>
      </tr>
    </table>
    </div>
</div>


<p>After doing some basic analysis of the core characteristics. The most important section of the RFM technique is grouping our behavior segments and determining how much engagement our brand has with the consumer.</p>

<h4>Input [7]:</h4>
<pre><code class="language-sql">
  WITH rfm AS 
  (
    SELECT 
      Customer_Name, 
      sum(sales) MonetaryValue,
      avg(sales) AvgMonetaryValue,
      count(Order_ID) Frequency,
      max(Order_Date) last_order_date,
      (SELECT max(Order_Date) FROM sales) max_order_date,
      DATEDIFF(DD, max(Order_Date), (SELECT max(Order_Date) FROM sales)) Recency
    FROM sales
    GROUP BY Customer_Name
  ),
  rfm_calc AS
  (
  
    SELECT r.*,
      NTILE(5) OVER (ORDER BY Recency DESC) rfm_recency,
      NTILE(5) OVER (ORDER BY Frequency) rfm_frequency,
      NTILE(5) OVER (ORDER BY MonetaryValue) rfm_monetary
    FROM rfm r
  )
  SELECT 
    c.*, rfm_recency+ rfm_frequency+ rfm_monetary AS rfm_cell,
    CAST(rfm_recency AS VARCHAR) + CAST(rfm_frequency AS VARCHAR) + CAST(rfm_monetary  AS VARCHAR)rfm_cell_string
  INTO #rfm
  FROM rfm_calc c
  
  SELECT Customer_Name , rfm_recency, rfm_frequency, rfm_monetary,
    case 
      WHEN rfm_cell_string in (555, 554, 544, 545, 454, 455, 445) THEN 'Champions'
      WHEN rfm_cell_string in (543, 444, 435, 355, 354, 345, 344, 335) THEN 'Loyal customers'
      WHEN rfm_cell_string in (553, 551, 552, 541, 542, 533, 532, 531, 452, 451, 442, 441, 431, 453, 433, 432, 423, 353, 352, 351, 342, 341, 333, 323) THEN 'Potential loyalist'
      WHEN rfm_cell_string in (512, 511, 422, 421, 412, 411, 311) THEN 'Recent customers'
      WHEN rfm_cell_string in (525, 524, 523, 522, 521, 515, 514, 513, 425, 424, 413, 414, 415, 315, 314, 313) THEN 'Promising'
      WHEN rfm_cell_string in (535, 534, 443, 434, 343, 334, 325, 324) THEN 'Customers needing attention' 
      WHEN rfm_cell_string in (331, 321, 312, 221, 213) THEN 'About to sleep' 
      WHEN rfm_cell_string in (255, 254, 245, 244, 253, 252, 243, 242, 235, 234, 225, 224, 153, 152, 145, 143, 142, 135, 134, 133, 125, 124) THEN 'At risk'
      WHEN rfm_cell_string in (155, 154, 144, 214, 215, 115, 114, 113) THEN 'Can’t lose them'
      WHEN rfm_cell_string in (332, 322, 231, 241, 251, 233, 232, 223, 222, 132, 123, 122, 212, 211) THEN 'Hibernating' 
      WHEN rfm_cell_string in (111, 112, 121, 131, 141, 151) THEN 'Lost'
    END rfm_segment
  FROM #rfm
  ORDER BY rfm_recency DESC, rfm_frequency DESC ,rfm_monetary DESC;
</code></pre>



<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>






